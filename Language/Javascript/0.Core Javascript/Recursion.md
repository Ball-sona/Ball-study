# 재귀

자바스크립트에서의 '재귀'에 대해 알아보자.

## 함수 내부 동작

함수를 한번 호출하면 정확히 하나의 [실행 컨텍스트](/Language/Javascript/0.Core%20Javascript/Execution%20Context.md)가 생성된다.

- 실행 컨텍스트란 <u>함수 실행에 대한 세부 정보를 담고 있는 내부 데이터 구조</u>로, 제어 흐름의 현재 위치, 변수의 현재 값, `this` 값 등 상세 내부 정보를 저장한다.
- 만약 실행되고 있던 함수가 어떤 이유로 인해 일시 중지될 경우, 해당 함수와 관련된 실행 컨텍스트가 '실행 컨텍스트 스택(execution context stack)' 이라는 특별한 자료 구조에 저장된다.
- 이후 스택에서 실행 컨텍스트가 꺼내지면, 중단되었던 함수의 실행이 재기된다. 실행 컨텍스트 내부에 실행 중단점이 저장되어 있기 때문에 중단된 시점부터 실행을 이어나갈 수 있다.

## 재귀 호출 내부 동작

함수 내부에 중첩 호출이 있을 때 호출 과정을 살펴보자.

```js
function recur(x) {
  if (x > 2) return x;
  recur(x + 1);
}
recur(1);
```

1. `recur(1)` 호출에 대한 실행 컨텍스트 `c1` 이 생성되고, 함수 실행이 시작된다.
2. 실행 중 `recur(x+1)` 를 만나면 함수 실행이 일시 중지되고, `c1` 은 '실행 컨텍스트 스택'에 저장된다.
3. `recur(2)` 이 호출되어 실행 컨텍스트 `c2` 가 생성되고, 함수 실행이 시작된다.
4. 실행 중 `recur(x+1)` 를 만나면 함수 실행이 일시 중지되고, `c2` 는 '실행 컨텍스트 스택'에 저장된다.
   - 현재 스택은 `[c1, c2]`
5. `recur(3)` 이 호출되어 실행 컨텍스트 `c3` 이 생성되고, if문의 조건이 충족되었으므로 3을 반환하고 함수 실행이 종료된다.
6. 실행 컨텍스트 스택에서 가장 위에 있는 `c2`를 꺼내고, 이와 관련된 함수 `recur(2)` 의 실행을 재기한다.
7. `recur(2)` 이 실행이 종료되면 스택에서 `c1` 을 꺼내고, 이와 관련된 `recur(1)`의 실행을 재기한다.
8. 마지막 실행 컨텍스트까지 처리했으므로 함수 실행이 종료된다.

## 재귀 깊이

- 재귀 깊이(recursion depth)는 <u>스택에 들어가는 실행 컨텍스트 수의 최댓값</u>이다.
- 자바스크립트 엔진은 최대 재귀 깊이를 만개까지는 허용한다. 엔진에 따라 이보다 더 깊이 허용할 수는 있지만 대부분 십만까지는 다루지 못한다.
- 엔진 내부에서는 이러한 깊이 제한 완화를 위해 최적화(tail calls optimization)를 수행한다.
- 스택에 쌓이는 각각의 실행 컨텍스트는 메모리 공간을 차지한다. 따라서 재귀 함수를 설계할 때는 메모리 요구사항에 유의해야 한다.

## 재귀적 자료구조

재귀적 자료 구조 중 하나인 연결 리스트(Linked List)를 사용하면 효율적인 경우가 있다.

```js
let linkedList = {
  value: 2,
  next: {
    value: 3,
    next: {
      value: 4,
      next: null, // 마지막 요소는 next값이 null이어야함.
    },
  },
};

// 맨 앞에 요소 추가하기
linkedList = { value: 1, next: linkedList };
// 중간 요소 제거하기
linkedList.next = linkedList.next.next;
```

- 만약 배열의 맨 앞에 요소를 추가하는 경우 배열의 요소 인덱스를 모두 재할당해줘야 하므로 배열의 규모가 커지면 연산 시간이 더 오래걸리지만, 위처럼 연결 리스트를 사용하는 경우 한번의 할당을 통해 쉽게 조작이 가능하다.
- 단, 연결 리스트는 인덱스를 통해 요소에 접근하는 것이 불가능하다는 단점이 있다.
