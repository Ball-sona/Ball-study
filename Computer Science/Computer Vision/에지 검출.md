# 에지 검출

에지 검출 알고리즘은 명암, 컬러, 또는 텍스처의 변화량을 측정하고 변화량이 큰 곳을 에지로 검출한다. 

## 에지 연산자

기본적으로 에지는 미분 연산을 사용하여 구할 수 있다. 

그러나 현실에서는 불완전한 광학으로 인해 발생하는 잡음을 해결하기 위해 스무딩 연산을 적용해야 한다. 그러나 스무딩은 크기가 3X3 이상의 연산자를 사용하므로 1X2 크기의 에지 연산자에는 적합하지 않다. 따라서 마스크를 dXd 크기의 **정방향으로 확장**해 연산자 자체가 스무딩 효과를 지니도록 설계한다. 

잘 알려진 연산자에는 로버츠 연산자, 프레윗 연산자, 소벨 연산자 등이 있다. 

## 가우시안 필터(Gaussian)

가우시안 필터는 가까운 픽셀은 큰 가중치를, 멀리 있는 픽셀은 작은 가중치를 사용하여 평균을 계산하게 된다. 

- 표준편차를 통해 스케일 조절이 가능하다. 
- 마스크 크기가 작으면 오차가 발생하고, 크기가 크면 계산 시간이 오래 걸린다. 따라서 6a+1를 마스크 크기로 설정하는 것이 이상적인 방법이다. (Ex. a=3이면 19*19 마스크 사용) 

## 라플라시안 필터(Laplacian)

라플라시안 필터는 2차 미분을 적용한 필터이다. 

## LoG(Laplacian of Gaussian)

LoG는 가우시안을 적용한 후, 그 결과에 라플라시안을 사용하는 필터이다. 

- 라플라시안을 사용하면 잡음에 민감해지므로, 그 전에 잡음을 줄여주는 가우시안 스무딩을 적용한다. 

## DoG(Difference of Gaussian)

DoG는 각 가우시안의 표준편차 값을 다르게 하여, 그 차이를 이용하는 방식이다. 

- LoG의 계산 시간을 줄여 준다.
- 표준 편차 값을 바꾸면서 에지 너비를 조절 가능하다. 

## 캐니 에지(Canny Edge)

캐니 에지 검출 알고리즘은 총 4단계로 이루어져 있다.

1. 노이즈 제거 : 입력 영상 f에 시그마 크기의 **가우시안 스무딩**을 적용한다. 

2. 경계 그레디언트 방향 계산 : 결과 영상에 **소벨 연산자**를 사용하여 에지 강도와 에지 방향 맵을 구한다. 

3. 비최대치 억제 : **비최대 억제**를 적용하여 얇은 두께 에지 맵을 만든다. 

   > 그레디언트 방향에서 검출된 경계 중 가장 큰 값만 선택하고 나머지는 제거하는 방식

4. 이력 스레시홀딩 : **이력 임계값**을 적용하여 거짓 긍정을 제거한다.

   > 두 개의 경계값을 지정해서 경계 영역에 있는 픽셀들 중 큰 경계 값 밖의 픽셀과 연결성이 없는 픽셀을 제거한다.  

### 케니 에지 알고리즘

```c
// 1. f에 가우시안을 적용하여 g를 얻는다.
// 2. g에 소벨 연산자를 사용하여 에지 강도맵 S와 에지 방향맵 D를 얻는다.
// 3. 비최대 억제
for (y=1..M-2) {
	for(x=1..N-2) {
		// 여기서 (y1,x1)와 (y2,x2)는 (y,x)의 이웃 화소
		if(S(y,x) <= S(y1,x1) or S(y,x) <= S(y2,x2)) S(y,x) = 0
	}
}
// 4. 이력 임계값을 이용한 에지 추적
...
```

## 허프 변환(Hough)

허프 변환은 이미지에서 직선, 원 등 모양을 찾는 방법 중 하나이다. 직선, 원 등을 검출할 때 그에 맞는 n차 방정식을 세운 뒤 특징점들과 거리를 측정하여 값이 가장 낮은 식을 출력하는 방식이다. 

원을 검출하기 위해서는 3차원 누적 배열을 사용한다. 

```
(y-b)2 + (x-a)2 = r2
```

 

